# 3.5 操作符

- JS中操作符的与众不同之处在于，它们可以适用于很多值。
  - 在应用于对象时，相应的操作符通常都会调用对象的valueOf()或toString()方法，以便取得可以操作的值。

## 3.5.1 一元操作符

- 只能操作一个值的操作符叫做**一元操作符**。

### 1.递增和递减操作符

- 有两个版本:前置型和后置型。
  - 执行前置递增和递减操作时，变量的值都是在语句被求值以前改变的。
    - 在计算机科学领域，这种情况通常被称作副效应。
  - 后置递增和递减操作是在包含它们的语句被求值之后才执行的。
- 在应用于一个不同的值时，递增和递减操作符遵循下列规则:
  - 在应用于一个包含有效数字字符的字符串时，先将其转换为数字值，再执行加减1的操作。字符串变量变成数值变量。
  - 在应用于一个不包含有效数字字符的字符串时，将变量的值设为NaN。字符串比哪里变成数值变量。
  - 在应用于布尔值false时，先将其转换为0再执行加减1的操作。布尔值变量变成数值变量。
  - 在应用于布尔值true时，先将其转换为1再执行加减1的操作。布尔值变量变成数值变量。
  - 在应用于浮点数值时，执行加减1的操作。
  - 在应用于对象时，先调用对象的valueOf()方法以取得一个可供操作的值。然后对该值应用前述规则。
    - 如果结果是NaN，则在调用toString()方法后再应用前述规则。
    - 对象变量变成数值变量。

### 3.一元加和减操作符

- 一元加操作符以一个加号(+)表示，放在数值前面，对数值不会产生任何影响。
- 在对非数值应用一元加操作符，该操作符会像Number()转型一样对这个值执行转换。
  - 布尔值false和true将被转换位0和1;
  - 字符串值会被按照一组特殊的规则进行解析；
  - 对于对象会先调用它们的valueOf()或toString()方法，再转换得到的值。

- 一元减操作符主要用于表示负数，例如将1转换成-1。
  - 在将一元减操作符应用于数值时，该值会变成负数。
  - 当应用于非数值时，一元减操作符遵循与一元加操作符相同的规则，最后再将得到的数值转换为负数。

## 3.5.2 位操作符

- 位操作符用于在最基本的层次上，即按内存中表示的数值的位来操作数值。
- 位操作符并不直接操作64位的值。
  - 先将64位的值转换成32位的整数，然后执行操作，最后再将结果转换回64位。

- 对于有符号的整数，32位中的前31位用于表示整数的值，第32位表示数值的符号。
  - 0表示整数，1表示负数。这个表示符号的位叫做**符号位**。
    - 符号位的值决定了其他数值的格式。
    - 正数以纯二进制格式存储，31位中的每一位都表示2的幂。
      - 第一位（叫做位0）表示2的0次幂，第二位表示2的1次幂，以此类推。没有用到的位以0填充，忽略不计。
      - 负数同样以二进制码存储，格式是**二进制补码**。计算一个数值的二进制补码，需要:
        1. 求这个数值绝对值的二进制码。
        2. 求二进制反码，即将0替换为1，将1替换为0；
        3. 得到的二进制反码加1.
> 默认情况下，JS中所有的整数都是有符号整数，当然也存在无符号整数。对于无符号整数来说，第 32 位不再表示符号，因为无符号整数只能是正数。而且，无符号整数的值可以更大，因为多出的一位不再表示符号，可以用来表示数值。

- 在JS中,当对数值应用位操作符时，会导致一个严重的副效应:
  - 在对特殊的NaN和Infinity值应用位操作时，这两个值都会被当成0来处理。
- 如果对非数值应用位操作符，会先使用Number()函数将该值转换为一个数值，然后再应用位操作，最后得到一个数值。

### 1.按位非(NOT)

- 按位非操作符由一个波浪线(~)表示，会返回数值的反码。
  - 按位非操作的本质:操作数的负值减1。

### 2.按位与(AND)

- 按位与操作符由一个和号字符(&)表示，有两个操作符数。
  - 按位与操作就是将两个数值的每一位对齐。

  | 第一个数值的位 | 第二个数值的位 | 结果 |
  | :---------: | :----------: | :-: |
  | 1 | 1 | 1 |
  | 1 | 0 | 0 |
  | 0 | 1 | 0 |
  | 0 | 0 | 0 |
  - 按位与操作只在两个数值的对应位都是1时才返回1,任何一位是0，结果都是0。

### 3.按位或(OR)

- 按位或操作符由一个竖线符号(|)表示，同样也有两个操作数。

  | 第一个数值的位 | 第二个数值的位 | 结果 |
  | :---------: | :----------: | :-: |
  | 1 | 1 | 1 |
  | 1 | 0 | 1 |
  | 0 | 1 | 1 |
  | 0 | 0 | 0 |

- 按位或操作在有一个位是1的情况下就返回1,只有在两个位都是0的情况下才返回0。

### 4.按位异或(XOR)

- 按位异或操作符由一个插入符号(^)表示，也有两个操作数。

  | 第一个数值的位 | 第二个数值的位 | 结果 |
  | :---------: | :----------: | :-: |
  | 1 | 1 | 0 |
  | 1 | 0 | 1 |
  | 0 | 1 | 1 |
  | 0 | 0 | 0 |
- 按位异或在两个数值对应位上只有一个1时才返回1，如果对应的两位都是1或都是0，则返回0。

### 5.左移

- 左移操作符由两个小于号(<<)表示，会将数值的所有位向左移动指定的位数。
  - 在向左移位后，原数值的右侧多出了5个空位。左移操作会以0来填充这些空位。
  - 左移不会影响到操作数的符号位。

### 6.有符号的右移

- 有符号的右移操作符由两个大于号(>>)表示，会将数值向右移动并保留符号位(即正负号标记)。
  - 有符号的右移操作与左移操作恰好相反。
  - 移位过程中，原数值也会出现空位，这次的空位出现原数值的左侧、符号位的右侧，JS会用符号位的值来填充所有空位。

### 7. 无符号右移

- 无符号右移操作符由3个大于号(>>>)表示，会将数值的所有32位都向右移动。
  - 对正数来说，无符号右移的结果与有符号右移相同；
  - 对负数来说，无符号右移时以0来填充空位，会把负数的二进制码当成正数的二进制码。
    - 由于负数以其绝对值的二进制补码形式表示，会导致无符号右移后的结果非常大。

## 3.5.3 布尔操作符

- 布尔操作符一共有3个: 非(NOT)、与(AND)和 或(OR)。

### 1.逻辑非

- 逻辑非操作符由一个叹号(!)表示，可以应用于JS中任何值。
  - 无论这个值是什么类型，这个操作符都会返回一个布尔值。
  - 逻辑非操作符会先将它的操作数转换为一个布尔值，然后再对其求反。
  - 逻辑非操作符遵循下列规则:
    1. 如果操作数是一个对象，返回false;
    2. 如果操作数是一个空字符串，返回true;
    3. 如果操作数是数值0，返回true;
    4. 如果操作数是任意非0数值（包括Infinity），返回false;
    5. 如果操作数是null，返回true;
    6. 如果操作数是NaN,返回true;
    7. 如果操作数是undefined，返回true。
- 逻辑非操作符还可以用于将一个值转换为与其对应的布尔值。
  - 同时使用两个逻辑非操作符，会模拟Boolean()转型函数的行为。
  - 第一个逻辑非操作会基于无论什么操作数返回一个布尔值，而第二个逻辑非操作则对该布尔值求反，便得到了这个值真正对应的布尔值。

### 2.逻辑与

- 逻辑与操作符由两个和号(&&)表示，有两个操作数。
  | 第一个操作数 | 第二个操作数 | 结果 |
  | :---: | :---: | :---: |
  | true | true | true |
  | true | false | false |
  | false | true | false |
  | false | false | false |

- 逻辑与操作可以应用于任何类型的操作数，而不仅仅是布尔值。
  - 在有一个操作数不是布尔值的情况下，逻辑与操作不一定返回布尔值。
    - 如果第一个操作数是对象，则返回第二个操作数；
    - 如果第二个操作数是对象，则只有在第一个操作数的求值结果为true的情况下才会返回该对象。
    - 如果两个操作数都是对象，则返回第二个操作数；
    - 如果有一个操作数是null，则返回null；
    - 如果有一个操作数是NaN,则返回NaN;
    - 如果有一个操作数是undefined,则返回undefined。
- 逻辑与操作属于短路操作，如果第一个操作数能够决定结果，那么就不会再对第二个操作数求值。
  - 对于逻辑与操作而言，如果第一个操作数是false,则无论第二个操作数是什么值，结果都不可能是true。

    ```js
    var found = true;
    var result = (found && someUndefinedVariable);  //这里会发生错误
    alert(result);  //这一行不会执行
    ```
    - 不能在逻辑与操作中使用未定义的值。

### 3.逻辑或

- 逻辑或操作符由两个竖线符号(||)表示，由两个操作数。
  | 第一个操作数 | 第二个操作数 | 结果 |
  | :---: | :---: | :---: |
  | True | true | true |
  | True | false | true |
  | false | true | true |
  | false | false | false|

- 与逻辑与操作相似，如果有一个操作数不是布尔值，逻辑或也不一定返回布尔值。
  - 如果第一个操作数是对象，则返回第一个操作数；
  - 如果第一个操作数的求值结果为false,则返回第二个操作数；
  - 如果两个操作数都是对象，则返回第一个操作数；
  - 如果两个操作数都是null，则返回null；
  - 如果两个操作数都是NaN，则返回NaN；
  - 如果两个操作数都是undefined，则返回undefined。
- 逻辑或操作符也是短路操作符，第一个操作数的求值结果为true，就不会对第二个操作数求值。
  - 可以利用逻辑或的这一行为来避免为变量赋null或undefined值。

## 3.5.4 乘性操作符

- JS定义了3个乘性操作符: 乘法、除法和求模。
  - 在操作数为非数值的情况下会执行自动的类型转换。
  - 如果参与乘性计算的某个操作数不视数值，后台会先使用Number()转型函数将其转换为数值。
    - 空字符串将被当作0，布尔值true将被当做1。

### 1.乘法

- 乘法操作符由一个星号(*)表示，用于计算两个数值的乘积。

- 在处理特殊值的情况下，乘法操作符遵循下列规则:
  - 如果操作数都是数值，执行常规的乘法计算，即两个正数或两个负数相乘的结果还是正数，而如果只有一个操作数有符号(负数)，那么结果就是负数。如果乘积超过了 ECMAScript 数值的表示范围，则返回Infinity 或-Infinity；
  - 如果有一个操作数是 NaN，则结果是 NaN；
  - 如果是 Infinity 与 0 相乘，则结果是NaN；
  - 如果是 Infinity 与非 0 数值相乘，则结果是 Infinity 或-Infinity，取决于有符号操作数的符号；
  - 如果是 Infinity 与 Infinity 相乘，则结果是Infinity；
  - 如果有一个操作数不是数值，则在后台调用Number()将其转换为数值，然后再应用上面的规则。

### 2. 除法

- 除法操作符由一个斜线符号(/)表示，执行第二个操作数除第一个操作数的计算。
- 与乘法操作符类似，除法操作符对特殊的值也有特殊的处理规则。这些规则如下：
  - 如果操作数都是数值，执行常规的除法计算，即两个正数或两个负数相除的结果还是正数，而如果只有一个操作数有符号(负数)，那么结果就是负数。如果商超过了 ECMAScript 数值的表示范围，则返回 Infinity 或-Infinity；
  - 如果有一个操作数是 NaN，则结果是 NaN；
  - 如果是 Infinity 被 Infinity 除，则结果是 NaN；
  - 如果是零被零除，则结果是 NaN；
  - 如果是非零的有限数被零除，则结果是 Infinity 或-Infinity，取决于有符号操作数的符号；
  - 如果是 Infinity 被任何非零数值除，则结果是 Infinity 或-Infinity，取决于有符号操作数的符号；
  - 如果有一个操作数不是数值，则在后台调用 Number()将其转换为数值，然后再应用上面的规则。

### 3.求模

- 求模（余数）操作符由一个百分号（%）表示。

- 与另外两个乘性操作符类似，求模操作符会遵循下列特殊规则来处理特殊的值：
  - 如果操作数都是数值，执行常规的除法计算，返回除得的余数；
  - 如果被除数是无穷大值而除数是有限大的数值，则结果是 NaN；
  - 如果被除数是有限大的数值而除数是零，则结果是 NaN；
  - 如果是 Infinity 被 Infinity 除，则结果是 NaN；
  - 如果被除数是有限大的数值而除数是无穷大的数值，则结果是被除数；
  - 如果被除数是零，则结果是零；
  - 如果有一个操作数不是数值，则在后台调用 Number()将其转换为数值，然后再应用上面的规则。

## 3.5.5 加性操作符

- 加性操作符也会在后台转换不同的数据类型。

### 1.加法

- 如果两个操作符都是数值，执行常规的加法计算，然后根据下列规则返回结果：
  - 如果有一个操作数是 NaN，则结果是 NaN；
  - 如果是 Infinity 加 Infinity，则结果是 Infinity；
  - 如果是-Infinity 加-Infinity，则结果是-Infinity；
  - 如果是 Infinity 加-Infinity，则结果是 NaN；
  - 如果是+0 加+0，则结果是+0；
  - 如果是-0 加-0，则结果是-0；
  - 如果是+0 加-0，则结果是+0。
  - 不过，如果有一个操作数是字符串，那么就要应用如下规则：
    - 如果两个操作数都是字符串，则将第二个操作数与第一个操作数拼接起来；
    - 如果只有一个操作数是字符串，则将另一个操作数转换为字符串，然后再将两个字符串拼接起来。
- 如果由一个操作数是对象、字符串值或布尔值，则调用它们的toString()方法取得相应的字符串值，然后再应用前面关于字符串的规则。

### 2.减法

- 减法操作符(-)是另一个极为常用的操作符。
- JS中的减法操作符在处理各种数据类型转换时，同样需要遵循一些特殊规则:
  - 如果两个操作符都是数值，则执行常规的算术减法操作并返回结果；
  - 如果有一个操作数是 NaN，则结果是 NaN；
  - 如果是 Infinity 减 Infinity，则结果是 NaN；
  - 如果是-Infinity 减-Infinity，则结果是 NaN；
  - 如果是 Infinity 减-Infinity，则结果是 Infinity；
  - 如果是-Infinity 减 Infinity，则结果是-Infinity；
  - 如果是+0 减+0，则结果是+0；
  - 如果是+0 减-0，则结果是-0；
  - 如果是-0 减-0，则结果是+0；
  - 如果有一个操作数是字符串、布尔值、 null 或 undefined，则先在后台调用 Number()函数将其转换为数值，然后再根据前面的规则执行减法计算。如果转换的结果是 NaN，则减法的结果就是 NaN；
  - 如果有一个操作数是对象，则调用对象的 valueOf()方法以取得表示该对象的数值。如果得到的值是 NaN，则减法的结果就是 NaN。如果对象没有 valueOf()方法，则调用其 toString()方法并将得到的字符串转换为数值。

## 3.5.6 关系操作符

- 小于（ <）、大于（ >）、小于等于（ <=）和大于等于（ >=）这几个关系操作符用于对两个值进行比较，比较的规则与我们在数学课上所学的一样。这几个操作符都返回一个布尔值 。

- 当关系操作符的操作数使用了非数值时，也要进行数据转换或完成某些奇怪的操作。以下就是相应的规则:
  - 如果两个操作数都是数值，则执行数值比较。
  - 如果两个操作数都是字符串，则比较两个字符串对应的字符编码值。
  - 如果一个操作数是数值，则将另一个操作数转换为一个数值，然后执行数值比较。
  - 如果一个操作数是对象，则调用这个对象的 valueOf()方法，用得到的结果按照前面的规则执行比较。如果对象没有 valueOf()方法，则调用 toString()方法，并用得到的结果根据前面的规则执行比较。
  - 如果一个操作数是布尔值，则先将其转换为数值，然后再执行比较。

- 比较字符串时，实际比较的是两个字符串中对应位置的每个字符的字符编码值。
  - 大写字母的字符编码全部小于小写字母的字符编码值。
- 要真正字母表顺序比较字符串，就必须把两个操作数转换为相同的大小写形式（全部大写或全部小写），然后再执行比较。

- 任何操作数与NaN进行关系比较，结果都是false。

## 3.5.7 相等操作符

- 确定两个变量是否相等是编程中的一个非常重要的操作。

- JS提供两种操作符:
  1. 相等和不相等——先转换再比较；
  2. 全等和不全等——仅比较不转换。

### 1.相等和不相等

- JS中的相等操作符由两个等于号(==)表示，如果两个操作数相等，则返回true。
- 不相等操作符由叹号后跟等于号(!=)表示，如果两个操作数不相等，则返回true。
  - 这两个操作符都会先转换操作数(**强制转型**),然后再比较它们的相等性。

- 在转换不同的数据类型时，相等和不相等操作符遵循下列基本规则:
  - 如果有一个操作数是布尔值，则在比较相等性之前先将其转换为数值——false 转换为 0，而true转换为 1；
  - 如果一个操作数是字符串，另一个操作数是数值，在比较相等性之前先将字符串转换为数值；
  - 如果一个操作数是对象，另一个操作数不是，则调用对象的 valueOf()方法，用得到的基本类型值按照前面的规则进行比较；

  这两个操作符在进行比较时则要遵循下列规则：
  - null 和 undefined 是相等的。
  - 要比较相等性之前，不能将 null 和 undefined 转换成其他任何值。
  - 如果有一个操作数是 NaN，则相等操作符返回 false，而不相等操作符返回 true。重要提示：即使两个操作数都是 NaN，相等操作符也返回 false；因为按照规则， NaN 不等于 NaN。
  - 如果两个操作数都是对象，则比较它们是不是同一个对象。如果两个操作数都指向同一个对象，则相等操作符返回 true；否则，返回 false 。

- 下表列出了一些特殊情况及比较结果:

  | 表达式 | 值 | 表达式 | 值 |
  | :---: | :-: | :---:| :-: |
  | null == undefined | true | true == 1 | true |
  | "NaN" == NaN | false | true == 2 | false |
  | 5 == NaN | false | undefined == 0 | false |
  | NaN == NaN | false | null = 0 | false |
  | NaN != NaN | true | "5" == 5 | true |
  | false == 0 | true |

### 2.全等和不全等

- 在比较之前不会转换操作数，全等操作符由3个等于号(===)表示。
  - 只在两个操作数未经转换就相等的情况下返回true。

- 不全等操作符由一个叹号后跟两个等于号(!==)表示。
  - 在两个操作数未经转换就不相等的情况下返回true。

- null == undefined 返回 true；但 null === undefined 返回false。

> 由于相等和不相等操作符存在类型转换问题，为了保持代码中数据类型的完整性，推荐使用全等和不全等操作符。

## 3.5.8 条件操作符

- JS中最灵活的操作符。

  `variable = boolean_expression ? true_value : false_value;`

  - 这段代码的含义就是基于对boolean_expression的求值结果，再来决定给变量variable赋什么值。

## 3.5.9 赋值操作符

- 简单的赋值操作符由等于号(=)表示，可以把右侧的值赋给左侧的变量。

- 如果在等于号(=)前面再添加乘性操作符、加性操作符或位操作符，就可以完成复合赋值操作。

- 每个主要算术操作符(以及个别的其他操作符)都有对应的复合赋值操作符，如下:
  - 乘/赋值（ *=）；
  - 除/赋值（ /=）；
  - 模/赋值（ %=）；
  - 加/赋值（ +=）；
  - 减/赋值（ =）；
  - 左移/赋值（ <<=）；
  - 有符号右移/赋值（ >>=）；
  - 无符号右移/赋值（ >>>=）。

- 设计这些操作符的主要目的就是简化赋值操作。使用它们不会带来任何性能的提升。

## 3.5.10 逗号操作符

- 使用逗号操作符可以在一条语句中执行多个操作。

- 逗号操作符多用于声明多个变量，还可以用于赋值。
  - 用于赋值时，逗号操作符总会返回表达式中的最后一项。
  